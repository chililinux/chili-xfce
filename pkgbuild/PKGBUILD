#!/usr/bin/env bash
# -*- coding: utf-8 -*-
# shellcheck source=/dev/null
# shellcheck shell=bash disable=SC2034,SC2154

# Maintainer: Vilmar Catafesta <vcatafesta@gmail.com>
pkgname=chili-xfce
pkgdesc="Meta package for xfce"
pkgver=$(date +%Y%m%d)
pkgrel=$(date +%H%M)
arch=('any')
license=('MIT')
url="https://github.com/chililinux/${pkgname}"
source=("git+${url}.git")
md5sums=('SKIP')
depends=(
  xfce4-session
)
optdepends=(
  exo 	#4.20.0-2 	Application library for the Xfce desktop environment 	2024-12-25 	
  garcon 	#4.20.0-2 	Freedesktop.org compliant menu library 	2024-12-25 	
  thunar 	#4.20.2-1 	Modern, fast and easy-to-use file manager for Xfce 	2025-02-14 	
  thunar-volman 	#4.20.0-2 	Automatic management of removable drives and media for Thunar 	2024-12-25 	
  tumbler 	#4.20.0-2 	Thumbnail service implementing the thumbnail management D-Bus specification 	2024-12-25 	
  xfce4-appfinder 	#4.20.0-2 	Application launcher and finder 	2024-12-25 	
  xfce4-panel 	#4.20.4-1 	Panel for the Xfce desktop environment 	2025-03-23 	
  xfce4-power-manager 	#4.20.0-3 	Power Manager for Xfce 	2024-12-25 	
  xfce4-session 	#4.20.2-1 	Xfce's session manager 	2025-03-24 	
  xfce4-settings 	#4.20.1-1 	Xfce's Configuration System 	2025-02-09 	
  xfce4-terminal 	#1.1.5-1 	A modern terminal emulator primarily for the Xfce desktop environment 	2025-03-26 	
  xfconf 	#4.20.0-2 	D-Bus-based configuration storage system 	2024-12-25 	
  xfdesktop 	#4.20.1-1 	Xfce's desktop manager 	2025-02-17 	
  xfwm4 	 # Xfce's window manager
  xfwm4-themes  	# A set of additional themes for the Xfce window manager
  xfce4-goodies
  lightdm
  lightdm-settings
  lightdm-slick-greeter
  chili-skel
  chili-utils
)

# Automatically detect and use the correct install file
if [ -e "${pkgname}.install" ]; then
	install=${pkgname}.install
elif [ -e "pkgbuild.install" ]; then
	install=pkgbuild.install
fi

package() {
	cd "${srcdir}/${pkgname}"

	# Instale todos os arquivos em /usr/share/${pkgname} no momento da criação do pacote:
	install -dm755 "${pkgdir}/usr/share/${pkgname}"
	printf "%s\n" "${optdepends[@]}" >"${pkgdir}/usr/share/${pkgname}/optdepends"

	# Copiar a estrutura de /etc, /usr e /opt para /usr/share/${pkgname}
	local dirs=("usr" "etc" "opt")
	for dir in "${dirs[@]}"; do
		if [ -d "${srcdir}/${pkgname}/${dir}" ]; then
			cp -a "${srcdir}/${pkgname}/${dir}" "${pkgdir}/usr/share/${pkgname}/"
		fi
	done

	# Install license file if present
	if [ -f "LICENSE" ]; then
		install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
	fi

	# Install documentation if present
	if [ -f "README.md" ]; then
		install -Dm644 README.md "${pkgdir}/usr/share/doc/${pkgname}/README.md"
	fi
}
